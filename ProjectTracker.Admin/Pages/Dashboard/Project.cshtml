@page
@model ProjectTracker.Admin.Pages.Dashboard.ProjectModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer L

<h2>@L["ProjectDashboard"]</h2>

<div class="row mb-3">
    <div class="col-md-3">
        <div class="card text-bg-light">
            <div class="card-body">
                <h5 class="card-title">@Model.Dashboard.Summary?.Name</h5>
                <p class="card-text">@L["Budget"]: @Model.Dashboard.Summary?.Budget</p>
            </div>
        </div>
    </div>
</div>

<canvas id="worklogChart"></canvas>

<table id="maintenanceTable" class="table table-striped"></table>

<div class="mt-3">
    <a asp-route-fmt="xlsx" asp-page-handler="Export" asp-route-projectId="@Model.ProjectId" class="btn btn-outline-success">Excel</a>
    <a asp-route-fmt="pdf" asp-page-handler="Export" asp-route-projectId="@Model.ProjectId" class="btn btn-outline-danger">PDF</a>
</div>

@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script>
        const data = @Json.Serialize(Model.Dashboard.WorkLogTrend);
        new Chart(document.getElementById('worklogChart'), {
            type: 'line',
            data: {
                labels: data.map(x => x.month),
                datasets: [{ label: 'Hours', data: data.map(x => x.hours) }]
            }
        });
        new DataTable('#maintenanceTable', {
            data: @Json.Serialize(Model.Dashboard.UpcomingMaintenance),
            columns: [
                { title: 'Equipment', data: 'equipment' },
                { title: 'NextDate', data: 'nextDate' },
                { title: 'Type', data: 'type' }
            ],
            dom: 'Bfrtip',
            buttons: ['copy', 'excel', 'pdf']
        });
    </script>
}
